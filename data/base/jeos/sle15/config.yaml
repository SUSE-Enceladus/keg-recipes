config:
  files:
    JeOS-sysconfig:
      - path: /etc/profile
        append: True
        content: |-
          # yast in Public Cloud images fix
          NCURSES_NO_UTF8_ACS=1
          export NCURSES_NO_UTF8_ACS
      - path: /etc/sysconfig/clock
        append: True
        content: |-
          DEFAULT_TIMEZONE="Etc/UTC"
          HWCLOCK="-u"
          UTC="true"
      - path: /etc/sysconfig/console
        append: True
        content: |-
          CONSOLE_ENCODING="UTF-8"
          CONSOLE_FONT="lat9w-16.psfu"
          CONSOLE_SCREENMAP="trivial"
  scripts:
    JeOS-allow-root-console: "egrep -q '^ttyS0$' /etc/securetty || echo ttyS0 >> /etc/securetty"
    JeOS-no-delta-rpms: "sed -i 's/# download.use_deltarpm = true/download.use_deltarpm = false/' /etc/zypp/zypp.conf"
    JeOS-polkit: "[ -x /sbin/set_polkit_default_privs ] && /sbin/set_polkit_default_privs"
    JeOS-prodlink: |-
      prodfile=(`grep -l '<codestream>' /etc/products.d/*prod`)
      if [[ ${#prodfile[*]} -ne 1 ]]; then
          echo "No base product package installed or base product ambiguous." >&2
          false
      else
          ln -sf `basename "${prodfile[0]}"` /etc/products.d/baseproduct
      fi
    JeOS-remove-root-pw: "sed -i 's/^root:[^:]*:/root:*:/' /etc/shadow"
  services:
    JeOS-services:
      - boot.device-mapper
      - haveged
      - sshd
      - name: acpid
        enable: False
      - name: boot.efivars
        enable: False
      - name: boot.lvm
        enable: False
      - name: boot.md
        enable: False
      - name: boot.multipath
        enable: False
      - name: display-manager
        enable: False
      - name: kbd
        enable: False
  sysconfig:
    JeOS-sysconfig:
      - file: /etc/sysconfig/keyboard
        name: COMPOSETABLE
        value: "clear latin1.add"
      - file: /etc/sysconfig/language
        name: INSTALLED_LANGUAGES
        value: ""
      - file: /etc/sysconfig/language
        name: RC_LANG
        value: "C.UTF-8"
      - file: /etc/sysconfig/security
        name: POLKIT_DEFAULT_PRIVS
        value: "restrictive"
      - file: /etc/sysconfig/windowmanager
        name: DEFAULT_WM
        value: ""
      - file: /etc/sysconfig/windowmanager
        name: INSTALL_DESKTOP_EXTENSIONS
        value: "no"
